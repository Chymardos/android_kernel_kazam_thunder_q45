#!usr/bin/perl
my $configFile = $ARGV[0];
my $optrConfigFile = $ARGV[1];
die "the file $configFile is NOT exsit\n" if ( ! -e $configFile);
die "the file $optrConfigFile is NOT exsit\n" if ( (! -e $optrConfigFile) && ($optrConfigFile ne "") );
open FILE, "<$configFile";
my %config_for;
while (<FILE>) {
	if (/^(\w+)\s*=\s*(\w+)/) {
		$config_for{$1} = $2;
	}
}
close FILE;
open FILE, "<$optrConfigFile";
while (<FILE>) {
        if (/^(\w+)\s*=\s*(\w+)/) {
                $config_for{$1} = $2;
        }
}
close FILE;


my $filedir = "mediatek/frameworks/common/src/com/mediatek/common/featureoption";
my $write_filename = "$filedir/FeatureOption.java";
my $input_file = "mediatek/build/tools/javaoption.pm";
open(INPUT,$input_file) or die "can not open $input_file:$!\n";
my %javaoption;
while(<INPUT>)
{
	chomp;
	next if(/^\#/);
	next if(/^\s*$/);
	if(/\s*(\w+)\s*/)
	{
                if ($javaoption{$1} == 1)
                {   
                        die "$1 already define in $input_file";
                } else {
                        push (@need_options,$1);
                        $javaoption{$1} = 1;
                }   
        }   
}


system("chmod u+w $write_filename") if (-e $write_filename);
system("mkdir -p $filedir") if ( ! -d "$filedir");
die "can NOT open $write_filename:$!" if ( ! open OUT_FILE, ">$write_filename");
print OUT_FILE "\/* generated by mediatek *\/\n\n";
print OUT_FILE "package com.mediatek.common.featureoption;\n";
print OUT_FILE "\npublic final class FeatureOption\n{\n";

#pre-parse dfo array start
my @dfoAll = ();
my @dfoSupport = split(/\s+/, $ENV{"DFO_NVRAM_SET"});
foreach my $dfoSet (@dfoSupport) {
    my $dfoSetName = $dfoSet."_VALUE";
    my @dfoValues = split(/\s+/, $ENV{"$dfoSetName"});
    foreach my $dfoValue (@dfoValues) {
        push(@dfoAll, $dfoValue);
    }
}

my @dfoArray = ();
foreach my $tempDfo (@dfoAll) {
    my $isFind = 0;
    #only eng load will enable dfo
    if ($ENV{"TARGET_BUILD_VARIANT"} eq "eng") {
        foreach my $isDfoSupport (@dfoSupport) {
            if ($ENV{$isDfoSupport} eq "yes") {
                my $dfoSupportName = $isDfoSupport."_VALUE";
                my @dfoValues = split(/\s+/, $ENV{"$dfoSupportName"});
                foreach my $dfoValue (@dfoValues) {
                    if ($tempDfo eq $dfoValue) {
                        $isFind = 1;
                        break;
                    }
                }

                if ($isFind == 1) {
                    break;
                }
            }
        }
    }

    if ($isFind == 1) {
        push(@dfoArray, $tempDfo);
    }
}
my %dfoHashArray;
@dfoHashArray{@dfoArray} = ();
#print "Enable: @dfoArray\n";
#pre-parse dfo array end

foreach my $option (@need_options) {
    # if option in  DFO_LIST THEN GEN FUNCTION CALL ELSE GEN AS NOMARL!
    if ($config_for{$option} eq "yes") {
        if (exists $dfoHashArray{$option}){
            &gen_java_file ($write_filename, $option, "DynFeatureOption.getBoolean(\"$option\")", "boolean");
        }else {
            &gen_java_file ($write_filename, $option, "true", "boolean");
        }
    }
    elsif ($config_for{$option} eq "no") {
        if (exists $dfoHashArray{$option}) {
            &gen_java_file ($write_filename, $option, "DynFeatureOption.getBoolean(\"$option\")", "boolean");
        } else {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    }
    elsif ($config_for{$option} =~/^[+-]?\d+$/)
    {
        if (exists $dfoHashArray{$option}) {
            &gen_java_file($write_filename,$option,"DynFeatureOption.getInt(\"$option\")", "int")
        } else {
            &gen_java_file($write_filename, $option, $config_for{$option}, "int");
        }
    }
    else
    {
    	#add BUG_ID:JWLW-1420 chenweihua 20131114 (start)
    	if ($option eq "RGK_ALWAYS_SHOW_MOBILE_GROUP_SUPPORT") {
            &gen_java_file ($write_filename, $option, "true", "boolean");
        }
    	#add BUG_ID:JWLW-1420 chenweihua 20131114 (end)
    	#add BUG_ID:JWLW-1237 chenweihua 20131113 (start)
    	if ($option eq "RGK_SHOW_SIM_CHANGE_DIALOG_WHEN_GMS_RUNNING_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add BUG_ID:JWLW-1237 chenweihua 20131113 (end)
    	#add BUG_ID:JWLW-892 chenweihua 20131112 (start)
    	if ($option eq "RGK_ENABLE_NETWORK_SETTINGS_UNDER_CALL_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add BUG_ID:JWLW-892 chenweihua 20131112 (end)
    	#add BUG_ID:DLLW-506 chenweihua 20131009 (start)
    	if ($option eq "RGK_CUCC_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add BUG_ID:DLLW-506 chenweihua 20131009 (end)
    	#add BUG_ID:JWLW-1236 chenweihua 20131108 (start)
    	if ($option eq "RGK_SHOW_DATA_ENABLE_FIRST_INSERT_SIM_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add BUG_ID:JWLW-1236 chenweihua 20131108 (end)
    	#add BUG_ID:DELJ-94 chenweihua 20130929 (start)
    	if ($option eq "RGK_ALWAYS_SHOW_DATA_TYPE_SUPPORT") {
            &gen_java_file ($write_filename, $option, "true", "boolean");
        }
    	#add BUG_ID:DELJ-94 chenweihua 20130929 (end)
        #add BUG_ID:JELY-2 daizhiyi 20130416 (start)
        if ($option eq "RGK_COOLPAD_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add BUG_ID:JELY-2 daizhiyi 20130416 (end)
        #add for coolpad contacts daizhiyi 20130527 (start)
        elsif ($option eq "RGK_COOLPAD_CONTACTS_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add for coolpad contacts daizhiyi 20130527 (end)
        #add BUG_id = DLLW-25 yb 20130911 (start)
        elsif ($option eq "RGK_CALL_INCOMING_WIDGET") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add BUG_id = DLLW-25 yb 20130911 (end)

        #add BUG_id = JLWL-1087 yb 20131105 (start)
        elsif ($option eq "RGK_FLY_EMERGENCY_CALL") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add BUG_ID:DELB-1134 by yb 20130730(end)

        #add BUG_ID:JWLW-200 liangyulong 20130905 (start)
        elsif ($option eq "RGK_AIRPLANE_SWITCH_WIFIBLUETOOTH") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #no: airplane mode, Does not control wifi and bluetooth
        #add BUG_ID:JWLW-200 liangyulong 20130905 (end)
        #add JWLW-84 songqingming 20130916 (start)
        elsif ($option eq "RGK_POSITIVO_MATCH_NUMBER_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-84 songqingming 20130916 (end)
        #add JWLW-1312 chenweihua 20131107 (start)
        elsif ($option eq "RGK_FLY_MATCH_NUMBER_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-1312 chenweihua 20131107 (end)
        #add DELJ-4 maoxinwei 20130922 (start)
        elsif ($option eq "RGK_IP_DIAL") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add DELJ-4 maoxinwei 20130922 (end)
        #add BUG_ID:JWLW-1048 chenchunyong 20131030 (start)
        elsif ($option eq "RGK_CUSTOMER_FLY") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add BUG_ID:JWLW-1048 chenchunyong 20131030 (end)
        #add DLLW-105 maoxinwei 20130924 (start)
        elsif ($option eq "RGK_FOR_BAIDU_DEFAULT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add DLLW-105 maoxinwei 20130924 (end)
    	#add BUG_ID:DLLW-424 zhushengui 20130929 (start)
		elsif($option eq "RGK_LANGUAGE_SET_BY_SIM_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false" , "boolean");
        }
    	#add BUG_ID:DLLW-424 zhushengui 20130929 (end)
	    #add BUG_ID:JWLW-682 zhanwenyu 20131010 start
		elsif($option eq "RGK_DEFAULT_MOBILE_DATA_ENABLED") {
            &gen_java_file ($write_filename, $option, "false" , "boolean");
        }
		#add BUG_ID:JWLW-682 zhanwenyu 20131010 end
        #add DLLW-691 songqingming 20131014 (start)
        elsif ($option eq "RGK_MIN_MATCH_11") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add DLLW-691 songqingming 20131014 (end)
    	#add DLLW-691 lixiaobin 20131017 (start)
    	elsif ($option eq "RGK_DEF_AUDIOPROFILE") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add DLLW-691 lixiaobin 20131017 (end)
    	elsif ($option eq "RGK_512M_RAM_OPTIMIZE") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
    	#add JWLW-652 zhangzixiao 131017 (start)
        elsif ($option eq "RGK_XOLO_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-652 zhangzixiao 131017 (end)
		#add BUG_ID:DELJ-181 zhanwenyu 20131018 start
		elsif($option eq "RGK_BLUETOOTH_TETHERING_ENABLED") {
            &gen_java_file ($write_filename, $option, "false" , "boolean");
        }
		#add BUG_ID:DELJ-181 zhanwenyu 20131018 end
		#add BUG_ID:DLLW-1079 zhushengui 20131018 (start)
		elsif ($option eq "RGK_VIDEOPLAYER_APP_SUPPORT") {
            &gen_java_file ($write_filename, $option, "true", "boolean");
        }
		#add BUG_ID:DLLW-1079 zhushengui 20131018 (end)
        #add JWLW-900 songqingming 20131025 (start)
        elsif ($option eq "RGK_DIALPAD_ASSOCIATE_NUMBER_DIALOG_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-900 songqingming 20131025 (end)
        #add JWLW-945 songqingming 20131028 (start)
        elsif ($option eq "RGK_CONTACT_ASSOCIATE_SIM_DISABLE") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-945 songqingming 20131028 (end)
        #add JWLW-1306 songqingming 20131111 (start)
        elsif ($option eq "RGK_CUSTOM_SIM_COLOR_SUPPORT") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add JWLW-1306 songqingming 20131111 (end)
        #add BUG_ID:JWLW-1125 maoxinwei 20131112 (start)
        elsif ($option eq "RGK_LONG_STRING_OPTIMIZATION") {
            &gen_java_file ($write_filename, $option, "false", "boolean");
        }
        #add BUG_ID:JWLW-1125 maoxinwei 20131112 (end)
		#add BUG_ID:JWLW-1286 zhanwenyu 20131115 (start)
		elsif($option eq "RGK_RINGTONE_SETTING") {
            &gen_java_file ($write_filename, $option, "false" , "boolean");
        }
		#add BUG_ID:JWLW-1286 zhanwenyu 20131115 (end)
		#add BUG_ID:bug_id:JBLW-9 shidongdong 20131122 (start)
		elsif($option eq "RGK_LOCK_SCREEN_OPEN_FLASHLIGHT") {
            &gen_java_file ($write_filename, $option, "false" , "boolean");
        }
		#add BUG_ID:bug_id:JBLW-9 shidongdong 20131122 (end)
        print "\"$option\" not match\n";
    }
}
print OUT_FILE "}\n";
close OUT_FILE;
sub gen_java_file {
	my ($filename, $option, $value, $type) = @_;
	print OUT_FILE "    /**\n     * check if $option is turned on or not\n     */\n";
	if ( $option eq "GEMINI") {
		print OUT_FILE "    public static final $type MTK_${option}_SUPPORT = $value;\n";
		print "public static final $type MTK_${option}_SUPPORT = $value\n";
	}
	else {
		print OUT_FILE "    public static final $type ${option} = $value;\n";
		print "public static final $type ${option} = $value\n";
	}
}
